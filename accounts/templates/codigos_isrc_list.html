
<!--HTML PARA MATCHING TOOL POR ISRC-->
{# templates/matching_tool_isrc.html #}
{% extends 'base.html' %}
{% load static %}

{% block title %}Códigos ISRC | KLAIM{% endblock %}
{% block body_class %}matching-isrc-page{% endblock %}

{# ---------- CSS específico ---------- #}
{% block extra_css %}
  <link rel="stylesheet" href="{% static 'css/pages/matching_tool_isrc.css' %}">
{% endblock %}

{# ---------- CONTENIDO ---------- #}
{% block content %}


<div class="container">
  <!-- Encabezado -->
  <div class="section-header">
    <h1 class="section-title">Códigos ISRC</h1>
  </div>

  <!-- Filtros -->
  <div class="filter-section">
    <form id="filter-form" method="get" style="display:flex;gap:1.5rem;flex-wrap:wrap;">
      <div>
        <label for="cliente" class="filter-label">Filtrar por cliente:</label>
        <select name="cliente" id="cliente" class="form-select form-control">
          <option value="">-- Todos --</option>
          {% for c in clientes %}
            <option value="{{ c.id_cliente }}"
              {% if c.id_cliente|stringformat:"s" == cliente_seleccionado|stringformat:"s" %}selected{% endif %}>
              {{ c.nombre_cliente }}
            </option>
          {% endfor %}
        </select>
      </div>

      <div style="display:flex;gap:.5rem;align-items:center;">
        <label for="cod_klaim" class="filter-label">Filtrar por Cod_Klaim:</label>
        <input type="number" name="cod_klaim" id="cod_klaim"
               class="form-control"
               placeholder="ID de obra" min="1"
               value="{{ cod_klaim_seleccionado|default_if_none:'' }}">
        <button type="submit" class="btn btn--primary" style="gap:.4rem;">
          Buscar
        </button>
      </div>
    </form>
  </div>

  <!-- Tabla -->
  <div class="table-container">
    <table class="data-table">
      <thead>
        <tr>
          <th>ID ISRC</th><th>Cod ISRC</th><th>Cod MLC</th><th>Work</th>
          <th>Artists</th><th>Artists Alt.</th><th>Title Alt.</th><th>Authors</th>
          <th>Matching Tool</th><th>Uses</th><th>Action</th>
        </tr>
      </thead>
      <tbody>
        {% for codigo in page_obj %}
        <tr>
          <td>{{ codigo.id_isrc }}</td>
          <td>{{ codigo.codigo_isrc }}</td>
          <td>{{ codigo.codigo_mlc }}</td>
          <td>{{ codigo.obra.titulo }}</td>
          <td>{% if codigo.id_artista_unico %}{{ codigo.id_artista_unico.nombre_artista }}{% else %}-{% endif %}</td>
          <td>{{ codigo.name_artista_alternativo|default:"-" }}</td>
          <td>{{ codigo.titulo_alternativo|default:"-" }}</td>
          <td>
            <ul style="margin:0;padding-left:1rem;">
              {% for oa in codigo.obra.obrasautores_set.all %}
                <li>{{ oa.autor.nombre_autor }}</li>
              {% endfor %}
            </ul>
          </td>
          <td>
            <span class="status-badge {% if codigo.matching_tool_isrc %}true{% else %}false{% endif %}">
              {{ codigo.matching_tool_isrc|yesno:"Sí,No" }}
            </span>
          </td>
          <td>
            <input type="number" class="usos-input"
                   id="usos_{{ codigo.id_isrc }}" min="0" max="999" placeholder="0"
                   data-id-subida="{{ codigo.codigo_mlc_id }}">
          </td>
          <td>
            <div class="action-buttons">
              <button class="btn btn--success" onclick="guardarMatchIsrc('{{ codigo.id_isrc }}')">
                Guardar&nbsp;Match
              </button>
              <button class="btn btn--danger" onclick="confirmarEliminarIsrc('{{ codigo.id_isrc }}')">
                Eliminar&nbsp;ISRC
              </button>
            </div>
          </td>
        </tr>
        {% empty %}
        <tr><td colspan="11" class="empty-state">No se encontraron registros</td></tr>
        {% endfor %}
      </tbody>
    </table>

    <!-- Paginación global -->
    <nav class="pagination">
      {% if page_obj.has_previous %}
        <a href="?page=1">&laquo; Primera</a>
        <a href="?page={{ page_obj.previous_page_number }}">Anterior</a>
      {% else %}
        <span class="disabled">&laquo; Primera</span>
        <span class="disabled">Anterior</span>
      {% endif %}

      <span class="current">
        Página {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}
      </span>

      {% if page_obj.has_next %}
        <a href="?page={{ page_obj.next_page_number }}">Siguiente</a>
        <a href="?page={{ page_obj.paginator.num_pages }}">Última &raquo;</a>
      {% else %}
        <span class="disabled">Siguiente</span>
        <span class="disabled">Última &raquo;</span>
      {% endif %}
    </nav>
  </div>
</div>
{% endblock %}

{# ---------- JS ---------- #}
{% block scripts %}
  <script src="{% static 'js/matching_tool_isrc.js' %}" defer></script>
{% endblock %}
