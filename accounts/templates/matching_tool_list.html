<!--HTML HISTORIAL MATCHINGTOOL-->

{# templates/matching_tool_historial.html #}
{% extends 'base.html' %}
{% load static %}

{% block title %}Matching Tool · Historial&nbsp;|&nbsp;KLAIM{% endblock %}
{% block body_class %}matching-historial-page{% endblock %}

{# ────────────────────────────────  CSS propio  ─────────────────────────────── #}
{% block extra_css %}
  <link rel="stylesheet" href="{% static 'css/pages/matching_tool_historial.css' %}">
{% endblock %}

{# ────────────────────────────────  CONTENIDO  ──────────────────────────────── #}
{% block content %}
<div class="particles" id="particles"></div>

<div class="container">
  <!-- Cabecera -->
  <div class="section-header">
    <h1 class="section-title">MATCHING TOOL – TITLES, AUTHORS &amp; ISRC</h1>
  </div>

  <!-- Buscador -->
  <div class="search-container">
    <form id="search-form" class="search-form">
      <input  id="work-title"    name="work_title"    class="form-control"
              type="text"  placeholder="Work Title"
              value="{{ request.GET.work_title|default_if_none:'' }}">

      <input  id="mlc-code"      name="mlc_code"      class="form-control"
              type="text"  placeholder="MLC Code"
              value="{{ request.GET.mlc_code|default_if_none:'' }}">

      <input  id="creation-date" name="creation_date" class="form-control"
              type="date"  placeholder="Creation Date"
              value="{{ request.GET.creation_date|default_if_none:'' }}">

      <select id="status" name="status" class="form-select">
        <option value=""         {% if request.GET.status == "" %}selected{% endif %}>All Status</option>
        <option value="Enviado"  {% if request.GET.status == "Enviado"  %}selected{% endif %}>Enviado</option>
        <option value="Aceptada" {% if request.GET.status == "Aceptada" %}selected{% endif %}>Aceptada</option>
        <option value="Rechazada"{% if request.GET.status == "Rechazada"%}selected{% endif %}>Rechazada</option>
      </select>

      <button type="button" class="btn btn--primary" onclick="search()">Buscar</button>
    </form>
  </div>

  <!-- Contenedor de tablas -->
  <div class="tables-container">
    <!-- Tabla títulos/autores -->
    <div class="table-wrapper">
      <h3 class="table-title">Titles&nbsp;and&nbsp;Authors</h3>

      <div id="table-titulo-autor-container" class="table-container">
        {% include 'matching_tool_table_partial.html' with page_obj=titulo_autor_page_obj %}
      </div>

      <div id="pagination-titulo-autor" class="pagination"></div>
    </div>

    <!-- Tabla ISRC -->
    <div class="table-wrapper">
      <h3 class="table-title">ISRC&nbsp;Records</h3>

      <div id="table-isrc-container" class="table-container">
        {% include 'matching_tool_isrc_table_partial.html' with page_obj=isrc_page_obj %}
      </div>

      <div id="pagination-isrc" class="pagination"></div>
    </div>
  </div>
</div>

<!-- Modal de actualización de estado -->
<div id="modal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeModal()">&times;</span>
    <h2>Modify Status</h2>

    <select id="estado-select" class="modal-select">
      <option value="Enviado">Enviado</option>
      <option value="Aceptada">Aceptada</option>
      <option value="Rechazada">Rechazada</option>
    </select>

    <button class="btn btn--primary" onclick="submitEstado()">Accept</button>
  </div>
</div>
{% endblock %}

{# ────────────────────────────────  SCRIPTS  ────────────────────────────────── #}
{% block scripts %}
  {# variables globales que el JS externo necesita #}
  <script>
    window.MATCH_URL_TA   = "{% url 'matching_tool_table_titulo_autor' %}";
    window.MATCH_URL_ISRC = "{% url 'matching_tool_table_isrc' %}";
    window.CSRF_TOKEN     = "{{ csrf_token }}";
  </script>

  <script src="https://code.jquery.com/jquery-3.6.0.min.js" defer></script>
  <script src="{% static 'js/matching_tool_historial.js' %}" defer></script>
{% endblock %}
