{# templates/lyricfind_pendientes.html #}
{% extends "base.html" %}
{% load static %}

{% block title %}LyricFind · Pendientes | KLAIM{% endblock %}
{% block body_class %}lyricfind-page{% endblock %}

{% block extra_css %}
  <link rel="stylesheet" href="{% static 'css/pages/lyricfind_pendientes.css' %}">
{% endblock %}

{% block content %}
<div class="container">
  <div class="section-header">
    <h2 class="section-title">Unprocessed Audios – LyricFind</h2>
  </div>

  {# ───────── Drop-zone ───────── #}
  <div id="dropZone" class="drop-zone">
    <div class="drop-zone-content">
      <svg class="upload-icon" viewBox="0 0 24 24">
        <path fill="currentColor"
              d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M13.5,16V19H10.5V16H8L12,12L16,16H13.5M13,9V3.5L18.5,9H13Z"/>
      </svg>
      <h3 class="drop-title">Suelta tu archivo MP3 aquí</h3>
      <div class="drop-details">Soporte para archivos .mp3 con metadatos ISRC</div>
    </div>
    <div class="drop-progress"></div>
    <div class="drop-particles"></div>
  </div>

  {# ───────── Tabla principal ───────── #}
  <div class="table-container">
    <table class="data-table">
      <thead>
        <tr>
          <th>Klaim</th><th>Title</th><th>Artist</th><th>ISRC</th><th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for link in pendientes %}
        <tr>
          <td>{{ link.obra_id }}</td>
          <td>{{ link.obra.titulo }}</td>
          <td>{{ link.id_isrc.id_artista_unico.nombre_artista }}</td>
          <td>{{ link.id_isrc.codigo_isrc }}</td>
          <td>
            <div class="action-buttons">
              <button class="btn btn--primary" onclick="window.openLyricModal({{ link.pk }})">
                Insert&nbsp;Lyric
              </button>
              <a class="btn btn--danger" href="{% url 'lyricfind_omitir' link.pk %}">
                Omit
              </a>
            </div>
          </td>
        </tr>
        {% empty %}
        <tr><td colspan="5" class="empty-state">Sin audios pendientes.</td></tr>
        {% endfor %}
      </tbody>
    </table>

    {# ───────── Paginación global ───────── #}
    <nav class="pagination">
      {% if page_obj.has_previous %}
        <a href="?page=1">&laquo;</a>
        <a href="?page={{ page_obj.previous_page_number }}">&lsaquo;</a>
      {% else %}
        <span class="disabled">&laquo;</span>
        <span class="disabled">&lsaquo;</span>
      {% endif %}

      <span class="current">
        Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}
      </span>

      {% if page_obj.has_next %}
        <a href="?page={{ page_obj.next_page_number }}">&rsaquo;</a>
        <a href="?page={{ page_obj.paginator.num_pages }}">&raquo;</a>
      {% else %}
        <span class="disabled">&rsaquo;</span>
        <span class="disabled">&raquo;</span>
      {% endif %}
    </nav>
  </div>
</div>


{# ───────── Modal oculto ───────── #}
<div id="lyricModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="window.closeLyricModal()">&times;</span>
    <h3>Paste Lyric and Confirm</h3>

    {#  ←↓↓ NUEVO atributo data-action-template ↓↓→  #}
    <form  id="lyricForm"  method="post"
           data-action-template="{% url 'lyricfind_guardar' 0 %}">
      {% csrf_token %}
      <textarea name="lyric_text" placeholder="Paste the song lyrics here…" required></textarea>
      <button type="submit" class="btn btn--primary">Save&nbsp;Lyrics</button>
    </form>

  </div>
</div>


{% endblock %}

{% block scripts %}
  <script src="{% static 'js/lyricfind_pendientes.js' %}" defer></script>
{% endblock %}
